#!/usr/bin/python

import sys
from MalwareSampleReport import MalwareSampleReport

inReportName = sys.argv[1]
outReportName = sys.argv[2]
featureFileName = sys.argv[3]

with open(featureFileName) as f:
    sigs = [l.strip() for l in f]


sample = MalwareSampleReport(inReportName)
if sample is None:
    print('{} had a json error'.format(inReportName))
    sys.exit(1)
else:
    #Make sure report is not empty
    if not hasattr(sample, 'report'):
        print('{} has an empty json report...'.format(inReportName))
        sys.exit(1)
    for sig in sigs:
        sigType, sigDesc, sigSeverity, sigValue = sig.split('|')
        sig_dict = {
            "families": list(),
            "description": sigDesc,
            "severity": int(sigSeverity),
            "marks": list(),
            "references": list(),
            "name": sigType,
        }
        if sigValue != '-1':
            sig_dict["value"] = float(sigValue)
        sample.add_signature(sig_dict)

    sample.dump_json_file(outReportName)
