#!/usr/bin/python
from sample_db_record import sample_db_record
import sys
import os
import errno

def download_file(google_id, destPath):
	gdriveToolPath = os.path.dirname(os.path.realpath(__file__)) + "/../gdrive-linux-x64"
	cmd = gdriveToolPath + " download --path " + destPath + " " + google_id
	os.system(cmd)	

#Copied from: http://stackoverflow.com/questions/600268/mkdir-p-functionality-in-python
def mkdir_p(path):
    try:
        os.makedirs(path)
    except OSError as exc:  # Python >2.5
        if exc.errno == errno.EEXIST and os.path.isdir(path):
            pass
        else:
            raise


if __name__ == "__main__":
	
	if (len(sys.argv) < 3):
		print "Invalid arguments to script. Specify the malware hash and what file is required (0->SampleGoogleID, 1->JSONReportID, 2->HTMLReportID, 3->RewrittenSampleID, 4->PCAPsZipID)"
		exit(-1)
	
	
	''' Read the malware hash '''
	hash_malware = str.lower(sys.argv[1])
	req=int(sys.argv[2])
	
	destPath = os.getcwd() + "/reports/" + hash_malware + "/"
        
        if (len(sys.argv) == 4):
                #We have a destination file path
		destPath = sys.argv[3]

	mkdir_p(destPath)	

	record = sample_db_record(hash_malware, True)
	
	google_id = str(record.get_google_id(req))
	
	if google_id!="NULL":
		download_file(google_id, destPath)

	
