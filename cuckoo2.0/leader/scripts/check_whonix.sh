#!/bin/bash

MACHINE_NAME="Whonix-Gateway"

# Check libvirt and see if the status of the machine is "running"
function check_if_up () {
	if [ "$(virsh list --all | grep "$MACHINE_NAME" | awk '{ print $3}')" == "running" ]; then
		return 0
	fi
	return 1
}

# If the machine is running when starting, exit immediately
if check_if_up; then
	exit 0
fi

# If the above check fails, start the machine
virsh start $MACHINE_NAME

sleep 20

if check_if_up ; then
	exit 0
fi

# If the machine has still not come up, return failure
exit 1
