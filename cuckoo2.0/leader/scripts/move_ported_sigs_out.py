#!/usr/bin/python
import os
import sys

orig_sig_list_file = "windows_non_ported_sigs.txt"

orig_table = dict()
sigs_folder = ""

try:
	sigs_folder = sys.argv[1] + "/modules/signatures/"
except IndexError:
	print "Please specify the cuckoo repo path"
	exit(-1)

new_folder = sigs_folder + "new_windows_sigs"

def get_file_name_without_ext(filename):
	return os.path.splitext(filename)[0]

if not os.path.isdir(sigs_folder + "windows"):
	print "Wrong cuckoo path"
	exit (-1)

#read orig signatures in a hash table
with open(sigs_folder + orig_sig_list_file) as f:
	contents = f.readlines()
	for line in contents:
		orig_table[line.replace('\n','').replace('\r','').replace(' ','')] = 1


try:
	os.mkdir(sigs_folder + new_folder)
except OSError:
	pass

#loop over all the signatures, move away the ones that are not in the hash table

for filename in os.listdir(sigs_folder + "windows/"):
	if filename.endswith(".py"):
		filename_no_ext = get_file_name_without_ext(filename)
		if filename in orig_table:
			pass
		else:
			# a new siganture
			os.rename(sigs_folder + "windows/" + filename, new_folder + "/" + filename)
			pycfile = filename_no_ext + ".pyc"
			try:
				os.rename(sigs_folder + "windows/" + pycfile, new_folder + "/" + pycfile)
			except Exception:
				pass





