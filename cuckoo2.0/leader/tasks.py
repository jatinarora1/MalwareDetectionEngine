from celery import Celery
import time
from kombu import Exchange,Queue
import os

app = Celery('tasks', broker='pyamqp://guest@localhost//')
app.config_from_object('settings')

@app.task
def runTask(x,binName):
	try:
		cmd = "./dvasion --create-rewritten-version --backup-result --base-cuckoo-runs 1  --file " + binName
		os.system(cmd)
		return 0
	except Exception as e:
		self.retry(countdown=3, exc=e, max_retries=3)

