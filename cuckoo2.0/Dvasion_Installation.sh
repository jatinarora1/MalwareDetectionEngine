#!/bin/bash

#Print header for the setup program
print_header () {
	printf "*************************************************************   \n"
	printf "  DVasion Installation Application			      \n\n"
	printf "  Distributed for use with The DVasion Sandboxing Platform      \n"
	printf "  Created by Second Write LLC. 2016			        \n"
	printf "								\n"
	printf "*************************************************************   \n\n"
}


run_calculate () {
	#Check if python exists	
	if ! command -v python > /dev/null 2>&1; then
		printf "Python 2.7 is not installed. Please install Python 2.7 before running this script.  \n"
		printf "If you are on a Debian based system (ex. Ubuntu) you can install this by running:   \n"
		printf "	sudo apt-get install python						    \n"
		return
	fi
	#Check python's version number
	if ! (python -V 2>&1 >/dev/null | grep -q "Python 2.") ; then
		printf "Python 2.7 is not installed, or is not set as the default python version	    \n"
	        printf "Please install Python 2.7 before running this script, or set 2.7 as the default.    \n"
		printf "If you are on a Debian based system (ex. Ubuntu) you can install this by running:   \n"
		printf "	sudo apt-get install python						    \n"
		return
	fi
	
	#Run the calculate script
	python ./leader/scripts/calculate/calculate.py

}

print_header


#Check to see if the user is running from inside the vm_setup directory or not
if [ ! -e ./leader/scripts/calculate/calculate.py ] ; then
	printf "Please run this from the root of the cuckoo folder. (i.e. the folder that this script is located in)\n"
	exit 1
fi

if [ -e ./leader/scripts/calculate/dvasion_config.conf ] ; then
	printf "dvasion_config.conf already exists in the ./leader/scripts/calculate directory\n"
	printf "Would you like to overwrite it? [N] (Y/N) "
	while true; do	
		read yn	
		case "$yn" in 
			"") break;;
			[Yy]* ) run_calculate; break;;
			[Nn]* ) break;;
			* ) echo "Please enter y or n.";;
		esac
	done
else
	run_calculate
fi
